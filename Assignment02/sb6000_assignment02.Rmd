---
title: "Group 07 Assignment02"
author: "Shameka Brayton, Brad O'Hara"
date: "7/23/2017"
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

![](BClogo.jpg) 
```{r setup, include=TRUE, echo = FALSE}

setwd("~/DropBox/NYU/02_Module/08_DMR/Assignment02")
# library("rmarkdown", lib.loc="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
# install.packages('RMySQL')
# install.packages('DMwR2')
 library(DMwR2)
library(plyr)
library(ggplot2)
library(reshape2)

```

# Introduction
need to put some introductory words here describing what we will be doing
```{r workingDir ,include=FALSE}
setwd("~/DropBox/NYU/02_Module/08_DMR/Assignment02")
```

# Data Gathering
For this assignment my team and I decided to use the wisconsin breast cancer research data found on the UCI website.  
- To begin the process, we pulled the data directly from the URL into a data frame.  
- Then we replaced the column headers wich were not included in the data, but we were able to pull from the data dictionary made available by the UCI site.
```{r eval=TRUE, include=TRUE, echo=FALSE}
#loading the necessary library


library(data.table)

# pulling the data straight from the online site
mydat <- fread('https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data')

# altering the column names of my dataframe to match the data dictionary that was found online

names(mydat) <- c("patientID", "clump_thicknes","uniformity_cell_size","uniformity_cell_shape","marginal_adhesion","single_eipthelial","bare_nuclei","bland_chromatin","normal_nucleoli","mitoses","class")


```
Attributes for the dataset were given as follows:
```{r echo=FALSE}
con <- url("https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.names")
t<- readLines(con)
close(con)
t<- t[106:116]
t
```

#Data Cleansing
```{r  include=TRUE, echo=FALSE}

library(readr)
# here I want to replace an ? marks found in my data with na so that I can use R functions/packages to clean them up.
na.mydat <- parse_integer(mydat$bare_nuclei,na="?")

#Once I have made the ? na I want to add the vector back to my data frame
mydat$bare_nuclei<-na.mydat
noNA.mydat <- centralImputation(mydat) 
```

here we had to normalize `r nrow(mydat[!complete.cases(mydat),])` rows of data that contained NA's
by using the DMwR2 funciton "centralImputation" we were able to use the median to fill in for the NA entries within our dataset.


```{r echo=FALSE}

#here we will use knitr to produce a html friendly table to display the top 3 rows of na data examples.
library(knitr)
kable( head(mydat[!complete.cases(mydat),],3), caption = 'Top 3 Rows with Missing Data')

#I think I can consolidate the next two steps, but basically I am getting the rows we showed of unclean data and filtering the cleansed data table with the same rows.
t<-head(mydat[!complete.cases(mydat),],3)

pIDvector <-t$patientID

```

```{r echo=FALSE}
kable( noNA.mydat[noNA.mydat$patientID %in% pIDvector, ], caption = 'Same 3 rows, with NA\'s cleansed')
```

here we show the relationship between Benign and Malignant cases contained in our data.
```{r echo=FALSE}
B<-table(mydat$class)
barplot(as.matrix(B), main='Benign vs. Malignant Cases', ylab = 'Count of Cases', beside = TRUE,col = c("Pink","darkblue"), legend = rownames(B), ylim = c(0, round_any(nrow(mydat)+50,10)))
        

```



```{r  echo=FALSE}
# Logistic Regression on all variables on class to view significance of each variable

  model_all <- glm(as.factor(noNA.mydat$class) ~ marginal_adhesion + clump_thicknes  
                   + uniformity_cell_size+uniformity_cell_shape+single_eipthelial+bare_nuclei+bland_chromatin+normal_nucleoli+mitoses
                   , data=noNA.mydat, family = binomial )
  summary(model_all)

```

```{r  echo=FALSE}
#Drill down based on significance
model_sig<-glm(as.factor(noNA.mydat$class) ~ marginal_adhesion+clump_thicknes+uniformity_cell_size+uniformity_cell_shape+bare_nuclei+bland_chromatin+normal_nucleoli, data=noNA.mydat, family = binomial )
# summary(model_sig)
```

```{r  echo=FALSE}
# Logistic Regression of Marginal Adhesion on Class
model_ma<-glm(as.factor(class)~marginal_adhesion, data=noNA.mydat,family = binomial )


xmarginal_adhesion <- seq(0, 10, 0.01)

ymarginal_adhesion <-  predict(model_ma, list(marginal_adhesion = xmarginal_adhesion),type="response")

plot(noNA.mydat$marginal_adhesion, noNA.mydat$class, pch = 10, xlab = "Marginal Adhesion", ylab = "Class", main="Marginal Adhesion Based on Class")
lines(xmarginal_adhesion, ymarginal_adhesion)
```
```{r echo=FALSE}

# Looking at only malignant datapoints
mydat4<-subset(noNA.mydat, noNA.mydat$class == 4)

# Looking at only benign datapoints
mydat2<-subset(noNA.mydat, noNA.mydat$class == 2)


# Means of malignant columns
mydat4_mean<-colMeans(subset(mydat4, select = c(marginal_adhesion, clump_thicknes, uniformity_cell_size, uniformity_cell_shape, single_eipthelial, bare_nuclei, bland_chromatin, normal_nucleoli, mitoses)))

# Means of benign columns
mydat2_mean<-colMeans(subset(mydat2, select = c(marginal_adhesion, clump_thicknes, uniformity_cell_size, uniformity_cell_shape, single_eipthelial, bare_nuclei, bland_chromatin, normal_nucleoli, mitoses)))

# Plot means of malignant columns vs means of benign columns
# Merge benign and malignant mean tables
total<- merge(mydat4_mean, mydat2_mean, by="row.names")


# Use Melt to transform
df1 <- melt(total,"Row.names")

#Row.names to factor variabls
df1$Row.names<-as.factor(df1$Row.names)

#Replace NA with 0's
df1[is.na(df1)]<- 0
# 
# # GGplot
# ggplot(df1, aes(x = Row.names, y=value)) + geom_bar(aes(fill=variable),stat="identity", position ="dodge") + theme_bw()+ theme(axis.text.x = element_text(angle=-40, hjust=.1))

# GGplot
plot <- ggplot(df1, aes(x = Row.names, y=value)) + geom_bar(aes(fill=variable),stat="identity", position ="dodge") +  theme(axis.text.x = element_text(angle=-40, hjust=.1)) +scale_fill_manual(labels = c("Benign", "Malignant"),values = c("pink",  "darkblue"))
plot <- plot  + xlab("Attributes") + ylab("Count") 
plot 



```



##### 
```{r  echo=FALSE}
# library(ggplot2)
plot <- ggplot(data=noNA.mydat, aes(x=noNA.mydat$clump_thicknes, y=noNA.mydat$marginal_adhesion, col=noNA.mydat$class)) + ggtitle("Marginal adhesions vs Clump Thickness") + theme(plot.title = element_text(family = "Trebuchet MS", color="#666666", face="bold", size=18, hjust=0))

plot <- plot + geom_point(aes(size = .01))
plot <- plot + xlab("Clump Thickness") + ylab("Marginal Adhesion") +
   scale_fill_gradient(low="green",high="darkgreen")
plot
```


```{r  echo=FALSE}
library(ggplot2)
plot <- ggplot(data=noNA.mydat, aes(x=noNA.mydat$clump_thicknes, y=noNA.mydat$mitoses, col=noNA.mydat$class)) + ggtitle("Marginal adhesions vs Clump Thickness") + theme(plot.title = element_text(family = "Trebuchet MS", color="darkblue", face="bold", size=18, hjust=0))+scale_fill_gradient(low="green",high="darkred")

plot <- plot + geom_point(aes(size = .01))
plot <- plot + xlab("Clump Thickness") + ylab("Mitosis") 
plot
```
```

